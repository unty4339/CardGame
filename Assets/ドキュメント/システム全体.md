## デッキ・手札関係

- データ項目
    - カードテンプレート
        - カードそれ自体の性能を格納するデータ
        - カードタイプ
            - ユニット、トーテム、スペルの3種類
        - プレイコスト
            - プレイに必要なMPコスト
        - ユニット
            - プレイするとフィールドに対応するユニットを登場させる
        - トーテム
            - プレイするとフィールドに対応するトーテムを登場させる
        - スペル
            - プレイするとカードごとの決まった効果を得る

    - デッキレシピ
        - 各プレイヤーのデッキの元になるカードの情報
            - カードテンプレートとそのカードを入れる枚数という形で管理

---

## プレイヤーごとの情報

- データ項目
    - HP
        - 0になったら負ける
    - 最大MP
        - 毎ターン、MPは最大値になる
    - 現在MP
        - カードのプレイコストとして支払う
    - カード
        - 実際にデッキや手札を行き来するカードのデータ
        - 行動一覧
    - デッキ
        - 各プレイヤーが保持するカードの束のこと
        - 順序付きでカードの配列を保持する
    - 手札
        - 各プレイヤーが保持するカードのうち当人のみ参照できるもの
        - 順序なしでカードのセットを保持する
    - フィールドゾーン
        - ユニットとトーテムが配置される場所（後述）
        - 各プレイヤーについて順序付きでユニットとトーテムを保持する
        - ユニットやトーテムごとに固有の値を保持する
    - パートナーゾーン
        - パートナーを配置する場所（後述）

- 機能
    - デッキレシピを元にデッキを作成する（デッキはカード1枚ずつが区別され順序付きになる）
    - デッキの一番上からカードを選び手札に加える操作
    - 手札の特定のカードの行動一覧を得る
    - フィールドゾーンの特定のユニットやトーテムの行動一覧を得る
    - 効果で手札に新たなカードを加える

---


## ユニット・トーテム

- データ項目
    - ユニット
        - フィールドに存在するユニット。ユニットカードをプレイすると現れる
        - 体力
            - 0以下になると破壊される
        - 攻撃力
            - 戦闘時に相手の体力を減らす
        - 登場してからの経過ターン数
        - 攻撃権
        - 0個以上のキーワード能力のリスト
        - 0個以上の効果のリスト
        - ペアリング対象
    - トーテム
        - フィールドに存在するトーテム。トーテムカードをプレイすると現れる
    - キーワード能力
        - 速攻
            - 登場してから0ターン経過時でも相手ユニットに攻撃できる
        - 神速
            - 登場してから0ターン経過時でも相手ユニット・相手プレイヤーに攻撃できる
        - 守護
            - 守護がいる限り相手はプレイヤーを攻撃対象にできない
    - 効果
        - 発動タイミング
            - 手札中、出現時、出現中、破壊時、ペアリング時、ペアリング中、ペアリング解除時
        - 発動内容
    - 行動一覧
        - このユニットが取りうる行動のリスト

- 機能
    - 特定のカードがプレイされたとき、対応するユニット・トーテムを登場させる


---

## ステート管理・AI機能

- データ項目
    - 状態
        - 現在の自分から見た状況を一意に表現するデータ
            - 自分の手札の内容（順序なし or ソート）
            - 自分と相手のゾーンのユニットとトーテムの内容
            - HP
                - 自分と相手それぞれの残りヒットポイント
            - MP
                - 自分と相手それぞれの残りマナポイント
    - 状態評価値
        - 状態に対して計算される評価値
    - 行動
        - 各カードやユニットを選択して使用できる行動の種類を表す
        - 行動種類
            - 攻撃、プレイ
        - 行動対象
            - 行動の中には場の特定のカードを選んだり効果の選択肢を選ぶものもあるため
    - 行動一覧
        - ある状態で自分が取りうる行動のリスト、手札とフィールドの全カード・ユニット・トーテムの行動を合わせたもの

- 機能
    - 現在のデッキ、手札、ゾーンの内容から状態を作成する
    - 状態から状態評価値を計算する
        - ユニットの数、ステータスなど状態のデータを特定の重みで評価し総和を取る
    - 現在の状態から行動一覧を作成する
    - 現在の状態から特定の行動を取った時の次の状態を作成する
    - 状態評価値を最大化するような行動の使用順を作成する
        - 状態→行動一覧作成→選択→次状態→…の繰り返しによる状態遷移で探索をする想定
---

## 戦闘システム

- データ項目
    - 攻撃対象

- 機能・仕様
    - 各ユニットは相手のユニットを攻撃できる（トーテムは攻撃できない）
        - ユニットを攻撃すると攻撃側と防御側の体力が互いの攻撃力分だけ減少し、それぞれ0以下になると破壊されゲームから取り除かれる
            - パートナーはパートナーゾーンに戻る
        - プレイヤーを攻撃すると攻撃側の攻撃力分だけ相手プレイヤーのHPが減少し、0以下にすると勝利する
    - 各ユニットは攻撃権を持ち、1度攻撃すると次のターンまで攻撃できない
    - 速攻・神速を持たないユニットは登場したターンに相手ユニットを攻撃できない
    - 神速を持たないユニットは登場したターンに相手プレイヤーを攻撃できない
    - 相手の場に守護を持つユニットがいる場合、相手プレイヤーを攻撃できない

---

## パートナー

- データ項目
    - パートナー
        - カードとしての性能

- 機能・仕様
    - パートナーはパートナーゾーンに表側で置かれる
        - コストを支払うとユニットとして登場する
        - ユニットとして破壊されるとパートナーゾーンに戻る

---

## 台詞マネージャ

- 機能・仕様
    - 特定のカードがプレイされる、破壊されるなどをトリガーに台詞用のコルーチンを起こす
    - 外部からこのマネージャにアクセスしてトリガーできるようにする

---

## 操作・アニメーション

- データ項目
    - 行動キュー

- 機能・仕様
    - プレイヤーまたはAIの操作を受け取って行動キューに貯める
    - 行動キューからひとつずつ消化し、アニメーションを流しつつオブジェクトを操作する

---

## ゲーム全体のフロー管理

1. 戦闘を初期化する
    - 先攻、後攻を決める
    - デッキをシャッフルしカードを5枚ずつ引く
    - 一度だけマリガンできる（戻すカードを選択してデッキに戻し、シャッフルし、戻した数だけ引き直す）
    - 初期HP 15、最大MP 0を得る

2. ターン開始
    - デッキからカードを1枚引く
        - カードを引けないプレイヤーは敗北する
    - ターンプレイヤーは最大MPが+1され、現在MPが全回復する
    - 場のユニットが攻撃権を得る
    - カードのプレイ、パートナーのプレイ、ユニットの攻撃をコストや攻撃権がある限り任意の順で行える
    - AIプレイヤーの場合
        - 現在の状態を作成
        - ステート管理・AI機能で行動キューを作成する
        - 行動キューに沿ってオブジェクトを操作
        - キューがなくなった時点でターンを渡す
    - ユーザープレイヤーの場合
        - 画面を操作し、何らかの有効な行動操作をするたびに行動キューに行動を加える
        - 並行して行動キューに沿ってオブジェクトを操作
        - ターン終了ボタンを押した時点でターン終了行動をキューに追加

3. 終了条件
    - 一方のプレイヤーのHPが0になったときもう一方が勝利
    - カードを引けないプレイヤーは敗北