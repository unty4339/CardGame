# クラス説明

- Unit
    - Monobehaviorを継承しない
    - フィールドに存在するユニットのデータについて責任を持つ
    - HPを示すintプロパティを持つ。0以下になると破壊される
    - Attackを示すintプロパティを持つ。戦闘時に相手の体力を減らす
    - TurnsOnFieldを示すintプロパティを持つ。登場してからの経過ターン数を保持する
    - CanAttackを示すboolプロパティを持つ。攻撃権の有無を保持する
    - Keywordsを示すList<KeywordAbility>プロパティを持つ。0個以上のキーワード能力のリストを保持する
    - Effectsを示すList<Effect>プロパティを持つ。0個以上の効果のリストを保持する
    - PairingTargetを示すUnitプロパティを持つ。ペアリング対象を保持する。 nullの場合はペアリングしていない

- Totem
    - Monobehaviorを継承しない
    - フィールドに存在するトーテムのデータについて責任を持つ
    - トーテム固有のデータを保持する

- KeywordAbility
    - enumクラス
    - キーワード能力を定義する
    - 速攻の値を保持する。登場してから0ターン経過時でも相手ユニットに攻撃できる
    - 神速の値を保持する。登場してから0ターン経過時でも相手ユニット・相手プレイヤーに攻撃できる
    - 守護の値を保持する。守護がいる限り相手はプレイヤーを攻撃対象にできない

- Effect
    - Monobehaviorを継承しない
    - 効果の定義について責任を持つ
    - TriggerTimingを示すEffectTriggerTimingプロパティを持つ。発動タイミングを保持する
    - EffectLogicを示すobjectまたはデリゲートプロパティを持つ。発動内容を保持する

- EffectTriggerTiming
    - enumクラス
    - 効果の発動タイミングを定義する
    - InHand、OnSummon、WhileOnField、OnDestroy、OnPairing、WhilePaired、OnUnpairの値を保持する

- UnitData
    - ScriptableObjectとして扱う
    - ユニットの基本性能データについて責任を持つ
    - BaseHP、BaseAttack、Keywordsの初期値などを保持する
    - CardTemplateから参照され、ユニット登場時にUnitの初期値を決定する

- TotemData
    - ScriptableObjectとして扱う
    - トーテムの基本性能データについて責任を持つ
    - CardTemplateから参照され、トーテム登場時にTotemの初期値を決定する

- UnitManager
    - Monobehaviorを継承する
    - シングルトンパターンを採用
    - ユニットとトーテムの登場・管理について責任を持つ
    - SpawnUnitFromCard (Card card, int ownerPlayerId, FieldZone fieldZone): カード、オーナーID、フィールドゾーンを受け取り、対応するユニットを登場させる
    - SpawnTotemFromCard (Card card, int ownerPlayerId, FieldZone fieldZone): カード、オーナーID、フィールドゾーンを受け取り、対応するトーテムを登場させる

# 処理シーケンス

## カードプレイ時のユニット登場の処理シーケンス

1. プレイ検知（ゲームフロー管理 → UnitManager）
    - ユニットカードがプレイされた
    - Card、オーナーID、対象のFieldZoneが渡される
    - SpawnUnitFromCard()が呼ばれる

2. テンプレートの確認（UnitManager）
    - CardのTemplateを取得する
    - CardTypeがUnitであることを確認する
    - TemplateのUnitDataを取得する

3. Unitインスタンスの生成（UnitManager）
    - UnitDataを元にUnitインスタンスを新規作成する
    - HP、AttackをUnitDataの値で初期化する
    - TurnsOnFieldを0に設定する
    - CanAttackをfalseに設定する（ターン開始時に攻撃権付与）
    - Keywords、EffectsをUnitDataからコピーする
    - PairingTargetをnullに設定する

4. フィールドへの配置（UnitManager）
    - 生成したUnitをFieldZoneのUnitsに追加する
    - 手札から該当Cardを削除する

5. 出現時効果の発動（UnitManager）
    - UnitのEffectsのうちTriggerTimingがOnSummonのものを発動する

## カードプレイ時のトーテム登場の処理シーケンス

1. プレイ検知（ゲームフロー管理 → UnitManager）
    - トーテムカードがプレイされた
    - Card、オーナーID、対象のFieldZoneが渡される
    - SpawnTotemFromCard()が呼ばれる

2. テンプレートの確認（UnitManager）
    - CardのTemplateを取得する
    - CardTypeがTotemであることを確認する
    - TemplateのTotemDataを取得する

3. Totemインスタンスの生成（UnitManager）
    - TotemDataを元にTotemインスタンスを新規作成する

4. フィールドへの配置（UnitManager）
    - 生成したTotemをFieldZoneのTotemsに追加する
    - 手札から該当Cardを削除する
